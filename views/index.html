<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Chat Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        border: "hsl(20 5.9% 20%)",
                        input: "hsl(20 5.9% 20%)",
                        ring: "hsl(24 5.7% 82.9%)",
                        background: "hsl(0 0% 0%)",
                        foreground: "hsl(60 9.1% 97.8%)",
                        primary: {
                            DEFAULT: "hsl(20.5 90.2% 48.2%)",
                            foreground: "hsl(60 9.1% 97.8%)",
                        },
                    },
                },
            },
        };
    </script>
    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message {
            animation: fadeIn 0.3s ease-out;
        }
        
        .dot-flashing {
            position: relative;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #a8a29e;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: 0.5s;
        }
        
        .dot-flashing::before,
        .dot-flashing::after {
            content: "";
            display: inline-block;
            position: absolute;
            top: 0;
        }
        
        .dot-flashing::before {
            left: -15px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #a8a29e;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 0s;
        }
        
        .dot-flashing::after {
            left: 15px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #a8a29e;
            animation: dotFlashing 1s infinite alternate;
            animation-delay: 1s;
        }
        
        @keyframes dotFlashing {
            0% {
                background-color: #a8a29e;
            }
            50%,
            100% {
                background-color: #57534e;
            }
        }
        
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        
        #messages::-webkit-scrollbar {
            width: 8px;
        }
        
        #messages::-webkit-scrollbar-track {
            background: hsl(12 6.5% 15.1%);
            border-radius: 4px;
        }
        
        #messages::-webkit-scrollbar-thumb {
            background: hsl(24 5.4% 63.9%);
            border-radius: 4px;
        }
        
        #messages::-webkit-scrollbar-thumb:hover {
            background: hsl(24 5.7% 82.9%);
        }
    </style>
</head>

<body class="bg-black text-stone-100 antialiased">
    <section class="min-h-screen flex flex-col items-center justify-center px-4 py-16 relative overflow-hidden w-full">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-5xl md:text-7xl font-bold tracking-tight">
                <span class="bg-gradient-to-r from-stone-200 via-stone-100 to-stone-300 bg-clip-text text-transparent">
            Chat with AI
          </span>
            </h1>
            <p class="text-stone-200 mt-4">
                Hello! I'm your AI assistant. How can I help you today?
            </p>
        </div>

        <!-- Chat Interface -->
        <div class="max-w-4xl w-full">
            <div class="bg-stone-950 border border-stone-800 rounded-2xl shadow-2xl overflow-hidden backdrop-blur-sm">
                <!-- Messages Container -->
                <div id="messages" class="h-[500px] overflow-y-auto p-6 space-y-4 scroll-smooth">
                    <!-- Le premier message de l'assistant -->
                    <div class="message flex gap-3">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="bg-stone-900 rounded-2xl rounded-tl-sm p-4 border border-stone-800">
                                <p class="text-stone-200">Hello! I'm your AI assistant. How can I help you today?</p>
                            </div>
                            <span class="text-xs text-stone-500 mt-1 ml-1 block">Just now</span>
                        </div>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="border-t border-stone-800 p-4 bg-stone-950">
                    <form id="chatForm" class="flex gap-3">
                        <input type="text" id="messageInput" placeholder="Ask me anything..." class="flex-1 px-4 py-3 bg-stone-900 border border-stone-800 rounded-xl text-stone-100 placeholder-stone-500 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all"
                            autocomplete="off" />
                        <button type="submit" id="sendButton" class="px-6 py-3 bg-gradient-to-r from-orange-600 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white rounded-xl font-medium transition-all transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                Send
              </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        const messagesContainer = document.getElementById("messages");
        const chatForm = document.getElementById("chatForm");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");

        function scrollToBottom() {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function formatTime() {
            const now = new Date();
            return now.toLocaleTimeString("en-US", {
                hour: "2-digit",
                minute: "2-digit"
            });
        }

        function escapeHtml(text) {
            const div = document.createElement("div");
            div.textContent = text;
            return div.innerHTML;
        }

        function addMessage(role, message) {
            const messageDiv = document.createElement("div");
            messageDiv.className = "message flex gap-3 " + (role === "user" ? "justify-end" : "");
            messageDiv.innerHTML = `
          ${role === "user" ? `
          <div class="flex-1 flex flex-col items-end">
            <div class="bg-gradient-to-r from-orange-600 to-orange-500 rounded-2xl rounded-tr-sm p-4 max-w-[80%]">
              <p class="text-white">${escapeHtml(message)}</p>
            </div>
            <span class="text-xs text-stone-500 mt-1 mr-1 block">${formatTime()}</span>
          </div>
          <div class="flex-shrink-0">
            <div class="w-8 h-8 rounded-full bg-stone-700 flex items-center justify-center">
            </div>
          </div>
          ` : `
          <div class="flex-shrink-0">
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
            </div>
          <div class="flex-1">
            <div class="bg-stone-900 rounded-2xl rounded-tl-sm p-4 border border-stone-800">
              <p class="text-stone-200">${escapeHtml(message)}</p>
            </div>
            <span class="text-xs text-stone-500 mt-1 ml-1 block">${formatTime()}</span>
          </div>
          `}
        `;
        messagesContainer.appendChild(messageDiv);
        scrollToBottom();
      }

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (!message) return;
        addMessage("user", message);
        messageInput.value = "";
        messageInput.disabled = true;
        sendButton.disabled = true;

        // Loading indicator
        const loadingDiv = document.createElement("div");
        loadingDiv.id = "loadingIndicator";
        loadingDiv.className = "message flex gap-3";
        loadingDiv.innerHTML = `<div class="dot-flashing"></div>`;
        messagesContainer.appendChild(loadingDiv);
        scrollToBottom();

        try {
          const response = await fetch(
  window.location.origin + "/conversation",
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query: message })
  }
);
          const data = await response.json();
          loadingDiv.remove();
          if (data.response) addMessage("assistant", data.response);
        } catch(err) {
          console.error(err);
          loadingDiv.remove();
          addMessage("assistant", "Failed to get response. Please try again.");
        } finally {
          messageInput.disabled = false;
          sendButton.disabled = false;
          messageInput.focus();
        }
      });

      messageInput.focus();
    </script>
</body>

</html>